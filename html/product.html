<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel='stylesheet' type='text/css' href='../css/public.css'/>
		<link rel='stylesheet' type='text/css' href='../css/product.css'/>
	</head>
	<body>
		<header>
			<div class='margin'>
				<div class='header-l'>
					<a href="#">收藏鲜花网</a>	
					<a href="#">关注微信</a>	
					<a href="#">花礼网APP</a>	
				</div>
				<div class='header-r'>
					<a href="login.html" class="login">请登录</a>	
					<a href="agree.html" class="agree">请注册</a>
					<span>|</span>
					<a href="#" id="red">订单查询</a>	
					<span>|</span>
					<a href="#">我的花礼</a>	
					<span>|</span>
					<a href="#">客户服务</a>	
					<span>|</span>
					<a href="car.html">购物车(0)</a>	
					<span>|</span>
					<a href="#">真爱如初</a>	
				</div>
			</div>
		</header>
		<div id='tou' class='margin'>
			<div class='logo'><img src="../images/t2.png"/></div>
			<div class="tou-c">
		    	<form>
		        	<input class="txt" id="txt" placeholder="鲜花" />
		            <input type="submit" class="sub" value="搜索" disabled />
		        </form>
		    	<p>
		        	<a href="#">玫瑰花</a>	
					<span>|</span>
					<a href="#">永生花</a>	
					<span>|</span>
					<a href="car.html">生日鲜花</a>
		        </p>
	   		 </div>
	   		 <div class='tou-r'>
	   		 		<a href="#">400-890-8818</a>	
					<span>|</span>
					<a href="#">在线客服</a>	
	   		 </div>
		</div>
		<div id="nav">
			<ul class="margin" >
		        <li class="te"><a href="../html/index.html">全部商品导购</a></li>  
	            <li><a href="#">鲜花</a></li>
	            <li><a href="../html/list.html">永生花</a></li>
	            <li><a href="#">蛋糕</a></li>
	            <li><a href="#">礼品</a></li>
	            <li><a href="#">巧克力</a></li>
	            <li><a href="#">花语大全</a></li>
	            <li><a href="#">企业团购</a></li>
	            <li><a href="#">设计师甄选鲜花</a></li>
	            <li><a href="#">教师节鲜花礼物 </a></li>
		    </ul>
		</div>
		<section id="information-main">
		    <div class="margin-information">
		        <div class="information-main-left">
		            <img class="information-url" src="../images/k1.jpg" />
	             	<div id="bigd">
		                <ul>
		                    <li id="li1"></li> 
		                    <li id="li2" ></li>   
		                    <li id="li3" ></li>   
	               		</ul>
           			</div>
		        </div>
		        <div class="information-main-right">
		            <p class="information-name" title="">一缕清香--向日葵3枝，白色洋桔梗0.5扎</p>
		            <div class="product_information">
		                <div class="product_price">
		                    <span class="span-left">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格：</span><span class="information-price">￥</span>
		                </div>
		                <div class="product_service">
		                    <div class="product_service-left">
		                        <span class="span-left">简&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;介：</span>
		                            <span class="information-tip"> </span>
		                    </div>
		                </div>
		            </div>
		            <div class="product_style">
		                <span class="span-left">&nbsp;&nbsp;类&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：</span>
		               	<span class="information-style"></span>
		               		
		               	</span>
		            </div>
		            <div class="product_number">
		                <span class="span-left">&nbsp;&nbsp;数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;量：</span>
		                <div class="product_number-right">
		                    <span class="information-jian">-</span>
		                    <input id="information-number" class="information-number" value="1" readonly="readonly">
		                    <span class="information-jia">+</span>
		                </div>
		            </div>
		            <div class="product_buy">
		                <button id="tocar" class="tocar"><a href="../html/car.html">添加购物车</a></button>
		            </div>
		    </div>
        </div>
</section>

		<div id="map" class="margin">
			<div class="advice">
			<h6>销量热销&nbsp;&nbsp;<a href="">HOT</a></h6>
			<ul>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				<li>
					<img src="../images/li1.jpg"/>
					<div class="box">
						<p>一缕清香</p>
						<span>￥99</span>
						<b>￥299</b>
					</div>
				</li>
				
			</ul>
		</div>
		<div class="active">
			<ul>
				<li><img src="../images/li1.jpg"></li>
				<li><img src="../images/k1.jpg"></li>
				<li><img src="../images/k2.jpg"></li>
				<li><img src="../images/k4.jpg"></li>
			</ul>
		</div>
	</div>
	</body>
	<script src="../js/ajax.2.0.js"></script>
	<!--<script src="../js/product.js"></script>-->
	<script src="../js/jquery.1.12.4.js"></script>
<script>
 class Information{
    constructor(){
        this.url = "http://localhost/hualiwang/data/goods6.json";
        this.buyObj = document.querySelector(".product_buy");
        this.produceNumber = document.querySelector(".product_number-right");
        this.number = document.querySelector(".information-number");
        this.load();
        // 1.准备绑定点击事件
        this.addEvent();
    }
    load(){
        var that = this;
        ajax({
            url:this.url,
            success:function(res){
                that.res = JSON.parse(res);
                // console.log(that.res);
                var Id = JSON.parse(localStorage.getItem("onlyId"));
                that.id=Id;
                console.log(Id);
//              that.id = this.Id;
                
                for(var i=0;i<that.res.length;i++){
                    // 判断符合
                    if(that.res[i].goodsId == Id){
                        // 做拿到相同数据之后的操作，可能是删除，可能是修改，取决于回调函数中传什么
                        $(".information-name").html(that.res[i].name);
                        $(".information-price").html("￥"+that.res[i].price);
                        $(".information-url").attr("src",that.res[i].url);
                        $(".information-service").html(that.res[i].service);
                        $(".information-style").html(that.res[i].style);
                         $(".information-tip").html(that.res[i].tip);
                    }
                }
            }
        })
    }
//     display(){
//         // console.log(this.res);  
//     }

    addEvent(){
        var that = this;
        this.produceNumber.addEventListener("click",function(eve){
            var e = eve || window.event;
            var target = e.target || e.srcElement;
            if(target.className == "information-jia"){
                target.parentNode.children[1].value++;
            }
            if(target.className == "information-jian"){
                if(target.parentNode.children[1].value<=1){
                    return false;
                }else{
                    target.parentNode.children[1].value--;
                } 
            }
        })
        this.buyObj.addEventListener("click",function(eve){
            var e = eve || window.event;
            var target = e.target || e.srcElement;
            if(target.className == "tocar"){
                // 2.提前找到点击商品的唯一的id
                that.num = target.parentNode.parentNode.children[3].children[1].children[1].value;
//              console.log(that.num)
                // 3.准备存储localstorage
                that.setLocal();
            }
        })
    }
    setLocal(){
        
        // 数据的格式：[{id:,num:,},{},{}]
        // 先读
        this.goods = localStorage.getItem("goods") ? JSON.parse(localStorage.getItem("goods")) : [];

        if(this.goods.length < 1){
            // 第一次存，直接存
            this.goods.push({
                id:this.id,
                num:this.num
            })
        }else{
            // 准备存重复数据的索引
            var i;
            // 利用some遍历数组，检测是否有重复数据
            var o = this.goods.some((val,index)=>{
                // 每次将索引，保存出来，
                i = index;
                // 如果id重复了，返回true，同时some自动停止
                return val.id == this.id;
            })
            // 如果some的返回值为true，表示肯定有一个值为true，那么表示有重复
            if(o){
                this.goods[i].num=parseInt(this.goods[i].num)+parseInt(this.number.value);
            }else{  //否则没有重复，再新增数据
                this.goods.push({
                    id:this.id,
                    num:this.number.value,
                })
            }

        }
        localStorage.setItem("goods",JSON.stringify(this.goods));
    }
}

new Information();

</script>
          
	
</html>
